FROM postgres:15-bullseye

ARG JDK_LOCALIZACAO
ARG APP_LOCALIZACAO

#VARIÁVEIS DE AMBIENTE QUE SÃO USADAS PELA IMAGEM DO POSTGRES PARA CRIAR O BANCO E O USUÁRIO NA INICIALIZAÇÃO
#ESTE BANCO É APENAS DE TESTES, NÃO TENDO PROBLEMA EM EXPOR OS DADOS DE ACESSO DESSA FORMA
ENV POSTGRES_DB postgres
ENV POSTGRES_USER postgres
ENV POSTGRES_PASSWORD postgres123

#GERANDO PASTA E COPIANDO OS ARQUVIOS DE CRIAÇÃO E INSERÇÃO DO BANCO DE DADOS PARA O CONTAINER
RUN mkdir -p /docker-entrypoint-initdb.d
WORKDIR /docker-entrypoint-initdb.d
COPY scripts .

RUN mkdir -p /app
RUN mkdir -p /app/jdk
WORKDIR /app

#JOGA NO DIRETÓRIO ATUAL O .JAR PASSADO COMO ARGUMENTO
COPY ${APP_LOCALIZACAO} .

#JOGA NO DIRETÓRIO ATUAL A JDK PASSADA COMO ARGUMENTO
COPY ${JDK_LOCALIZACAO} /app/jdk
RUN chmod +x /app/jdk/bin/*

COPY DockerNovoEntryPoint.sh .

#A IMAGEM DO POSTGRES POSSUI UM ENTRYPOINT PADRÃO QUE JÁ INICIALIZA O POSTGRES
#O ENTRYPOINT ABAIXO SOBRESCREVE ESSE ENTRYPOINT PADRÃO, MAS AGE COMO UM WRAPPER, CHAMANDO DEPOIS O SCRIPT DO ORIGINAL 
ENTRYPOINT ["./DockerNovoEntryPoint.sh"]
